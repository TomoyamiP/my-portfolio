<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Paul Miyamoto — Portfolio</title>
    <!-- Google Fonts: Inter (body) + Raleway (headings) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Raleway:wght@600;700&display=swap" rel="stylesheet">
    <!-- Swiper CSS (carousels) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <!-- Site CSS (compiled from site.css.scss) -->
    <link rel="stylesheet" href="/stylesheets/site.css">
    <!-- Lightbox minimal styles -->
    <style>
      .lightbox {
        position: fixed; inset: 0;
        background: rgba(0,0,0,.85);
        display: none; align-items: center; justify-content: center;
        z-index: 9999;
      }
      .lightbox.open { display: flex; }
      .lightbox img {
        max-width: 92vw; max-height: 92vh;
        border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,.6);
      }
      .lightbox .lb-close {
        position: absolute; top: 14px; right: 16px;
        background: rgba(0,0,0,.5); color: #fff;
        border: 1px solid rgba(255,255,255,.2);
        border-radius: 10px; padding: 8px 10px; cursor: pointer;
      }
    </style>
  </head>
  <body>
    <%= yield %>
    <!-- Lightbox root (click backdrop or button to close) -->
    <div id="lightbox" class="lightbox" aria-hidden="true">
      <button class="lb-close" type="button" aria-label="Close">Close ✕</button>
      <img id="lightbox-img" alt="">
    </div>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // ---------- OUTER: projects carousel (one slide per project)
        new Swiper('.projects-swiper', {
          loop: false,
          speed: 500,
          spaceBetween: 18,
          slidesPerView: 1,
          breakpoints: {
            960:  { slidesPerView: 1.2 },
            1200: { slidesPerView: 1.4 }
          },
          // ⬇️ important: disable drag on outer so inner swipers get the gesture
          allowTouchMove: false, // keep gestures for inner shots
          navigation: { nextEl: '.proj-next', prevEl: '.proj-prev' },
          pagination: {
            el: '.proj-pag',
            clickable: true,
            bulletClass: 'proj-bullet',               // custom class
            bulletActiveClass: 'proj-bullet-active',  // custom class
            renderBullet: (index, className) => `<span class="${className}"></span>`,
          },
          watchOverflow: true,
          keyboard: { enabled: true }           // optional: arrow keys for projects
        });

        // ---------- INNER: per-project screenshots (2–3 up on larger screens)
        document.querySelectorAll('.shots-swiper').forEach((el) => {
          const pagEl = el.parentElement.querySelector('.shots-pag');
          new Swiper(el, {
            loop: false,
            speed: 400,
            spaceBetween: 10,
            slidesPerView: 1,            // phones
            breakpoints: {
              640:  { slidesPerView: 2 }, // tablets
              1024: { slidesPerView: 3 }  // laptops/desktops
            },
            // ⬇️ important: mark inner swiper as nested
            nested: true,                         // <-- CHANGED
            pagination: pagEl ? { el: pagEl, clickable: true } : undefined,
            watchOverflow: true
          });
        });

        // ---------- LIGHTBOX
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightbox-img');

        const openLightbox = (src) => {
          lbImg.src = src;
          lb.classList.add('open');
          lb.setAttribute('aria-hidden', 'false');
        };

        const closeLightbox = () => {
          lb.classList.remove('open');
          lb.setAttribute('aria-hidden', 'true');
          setTimeout(() => { lbImg.src = ''; }, 150);
        };

        // click any .shot to open
        document.body.addEventListener('click', (e) => {
          const img = e.target.closest('.shot');
          if (!img) return;
          const full = img.getAttribute('data-full') || img.getAttribute('src');
          if (full) openLightbox(full);
        });

        // close on backdrop or close button
        lb.addEventListener('click', (e) => {
          if (e.target === lb || e.target.closest('.lb-close')) closeLightbox();
        });

        // close on Esc
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && lb.classList.contains('open')) closeLightbox();
        });

        // ----- Scroll opened <details> into view (center)
      document.querySelectorAll('.proj-details').forEach((d) => {
        d.addEventListener('toggle', function () {
          if (this.open) {
      this.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        });
      });
      });
    </script>
    <style>
      /* Outer dots: force colors + spacing */
      .proj-pag { margin-top:6px !important; margin-bottom:0 !important; display:flex; justify-content:center; }
      .proj-pag .proj-bullet {
        display:inline-block; width:10px; height:10px; border-radius:50%;
        margin:0 3px; background:#667 !important; opacity:.6 !important;
      }
      .proj-pag .proj-bullet.proj-bullet-active {
        background:#ffd166 !important; opacity:1 !important; transform:scale(1.15);
      }
    </style>
  </body>
</html>
